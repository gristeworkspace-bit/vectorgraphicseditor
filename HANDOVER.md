# 開発引継ぎ書: Vector Graphics Editor

## 📅 最終更新日: 2026-01-12
## 🚀 現在のフェーズ: Phase 6 (Undo/Redo) - 完了

## ✅ 実装完了済み機能
1. **Core Architecture:**
   - React + Rust (Wasm) 構成。`rust-core/` ディレクトリを使用（`src-tauri` は禁止）。
   - コマンドパターンによるState管理。

2. **基本操作 (Interaction):**
   - 選択、移動、リサイズ、回転（逆行列による正確なヒットテスト実装済み）。
   - 回転しても座標系が壊れない堅牢なマトリックス演算。

3. **ペンツール (Path Engine):**
   - クリックで直線、ドラッグでベジェ曲線を描画可能。
   - **重要:** ドラッグ時の曲線生成ロジックは「Illustrator準拠（始点固定・終点カーブ）」に修正済み。この挙動を維持すること。

4. **スタイル編集:**
   - プロパティパネルでの「Fill/Stroke」変更機能。
   - カラーピッカー操作時の「リアルタイム再描画」対応済み。

5. **レイヤー管理 (Z-Index):**
   - `bring_to_front()`: 選択オブジェクトを最前面に移動
   - `send_to_back()`: 選択オブジェクトを最背面に移動
   - プロパティパネルに「Layer Order」セクションを追加（⬆️ Front / ⬇️ Back ボタン）

6. **永続化 (Persistence):**
   - `export_scene_to_json()`: シーン全体をJSON文字列にエクスポート
   - `import_scene_from_json()`: JSON文字列からシーンをインポート
   - ヘッダーに「💾 Save」「📂 Load」ボタンを配置

7. **Undo/Redo:** ✨ NEW
   - `save_snapshot()`: 操作前に現在のシーンをスナップショット保存
   - `undo()` / `redo()`: 履歴スタックから状態を復元
   - 最大50回分の履歴を保持
   - ヘッダーに「↩️ Undo」「↪️ Redo」ボタン
   - キーボードショートカット：`Ctrl+Z` (Undo), `Ctrl+Y` / `Ctrl+Shift+Z` (Redo)

## 🚧 次に取り組むタスク (Next Actions)
**Phase 6 は完了しました。** 次は以下の機能拡張を検討してください：

1. **SVGエクスポート:**
   - 独自JSON形式に加え、SVG形式での出力対応

2. **レイヤーパネル (Tree View):**
   - ドキュメント構造をツリー表示
   - ドラッグ&ドロップによる順序変更
   - 可視性トグル、ロック機能

3. **グループ機能:**
   - 複数オブジェクトのグループ化/解除
   - グループ階層の管理

4. **ズーム/パン:**
   - キャンバスの拡大縮小
   - スクロール/パン操作

## ⚠️ 技術的な注意点 (Constraints)
- **ディレクトリ構造:** Rustのコードは必ず `rust-core/` にある。
- **ペンツール:** `cp1` の計算ロジックにいらぬ "デバッグ用オフセット" を加えないこと（波線になってしまうため）。
- **再描画:** React側でRustの状態を変更した際は、必ず明示的な再描画トリガーを引くこと。
- **Undo:** 破壊的操作の前に必ず `editor.save_snapshot()` を呼び出すこと。
- **シリアライズ:** `SceneGraph` に `#[serde(skip)]` を付けた `transform_cache` フィールドがあるので注意。
